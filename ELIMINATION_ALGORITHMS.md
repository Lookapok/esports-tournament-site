# 淘汰賽演算法使用說明

## 功能概述

已成功實現單淘汰賽和雙淘汰賽的自動排程演算法，支援以下功能：

### 1. 單淘汰賽 (Single Elimination)
- 敗者直接淘汰
- 自動計算所需輪數
- 處理非 2 的次方隊伍數量（部分隊伍輪空）
- 自動生成所有輪次的比賽

### 2. 雙淘汰賽 (Double Elimination)
- 每隊有兩次失敗機會
- 分為勝部 (Upper Bracket) 和敗部 (Lower Bracket)
- 包含總決賽和可能的重賽
- 複雜的晉級邏輯

## 使用方法

### Django Admin 介面
1. 進入 Django Admin
2. 選擇要排程的賽事
3. 在動作選單中選擇「為選定的賽事自動產生賽程」
4. 系統會根據賽事格式自動生成對應的比賽

### 前端介面
1. 進入賽事詳情頁面
2. 點擊「生成賽程」按鈕
3. 系統會自動產生並顯示對戰樹

### 管理命令測試
```bash
# 測試單淘汰賽
python manage.py test_elimination --tournament-id 1 --format single

# 測試雙淘汰賽
python manage.py test_elimination --tournament-id 1 --format double
```

## 演算法特點

### 單淘汰賽演算法
- **時間複雜度**: O(n) 其中 n 是隊伍數量
- **比賽場數**: n-1 場比賽（n 個隊伍）
- **輪數計算**: log₂(bracket_size) 其中 bracket_size ≥ n
- **輪空處理**: 自動處理非完美括號大小

### 雙淘汰賽演算法
- **時間複雜度**: O(n log n)
- **比賽場數**: 最多 2n-2 場比賽
- **勝部輪數**: log₂(bracket_size)
- **敗部輪數**: 約 2 × 勝部輪數

## 資料庫結構

### Match 模型欄位
- `is_lower_bracket`: 布林值，標示是否為敗部比賽
- `round_number`: 整數，輪次編號
- `team1`, `team2`: 對戰隊伍（可為空，表示待定）
- `winner`: 獲勝隊伍

## 前端顯示

### 單淘汰賽
- 標準對戰樹格式
- 自動標示決賽、準決賽等
- 勝者高亮顯示

### 雙淘汰賽
- 分割顯示勝部和敗部
- 不同顏色區分（藍色勝部，紅色敗部）
- 包含總決賽顯示

## 晉級處理

### 自動晉級函數
```python
# 單淘汰賽自動晉級
advance_single_elimination_winners(tournament)

# 雙淘汰賽晉級（複雜邏輯，需根據具體需求實現）
advance_double_elimination_winners(tournament)
```

## 注意事項

1. **隊伍數量**: 建議至少 4 支隊伍參賽
2. **資料完整性**: 確保所有參賽隊伍都已正確添加
3. **比賽結果**: 需要手動或通過 API 更新比賽結果
4. **晉級邏輯**: 當比賽完成後，需要呼叫晉級函數來安排下一輪對手

## 擴展功能

### 可能的改進
1. **自動晉級**: 當比賽結果更新時自動安排下一輪
2. **種子排序**: 支援種子隊伍的特殊排列
3. **三四名決賽**: 為單淘汰賽添加季軍戰
4. **瑞士制轉換**: 支援從瑞士輪轉為淘汰賽

### API 支援
所有演算法都可以通過現有的 API 介面使用，支援 Discord 機器人等外部應用整合。
